openapi: 3.0.2
info:
  title: Territories
  description: |
    Territory API is used to manage territories.
  contact:
    name: Sam
    email: sam102022@hotmail.com
  version: 1.0.0
servers:
  - url: 'http://localhost:8080'
tags:
   - name: Bookings
     description: Manage bookings

paths:
  /v1/resources/bookings:
    post:
      tags:
      - Bookings
      summary: Add a reservation
      description: Add a reservation
      operationId: addReservation
      requestBody:
        description: reservation
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/BookingIn'
        required: true
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
        400:
          description: Resource does not exist.
          content:
            application/json:
              schema:
                $ref: 'commons-models.openapi.yaml#/components/schemas/ApiError'

  /v1/resources/bookings/{id}:
    get:
      tags:
      - Bookings
      summary: Get reservation
      description: Get reservation
      operationId: getReservation
      parameters:
      - name: id
        in: path
        description: Booking's id
        required: true
        schema:
          type: integer
          format: int32
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
        400:
          description: Resource does not exist.
          content:
            application/json:
              schema:
                $ref: 'commons-models.openapi.yaml#/components/schemas/ApiError'

    put:
      tags:
      - Bookings
      summary: Update a reservation
      description: Update a reservation
      operationId: updateReservation
      parameters:
      - name: id
        in: path
        description: Booking's id
        required: true
        schema:
          type: integer
          format: int32
      requestBody:
        description: reservation
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/BookingIn'
        required: true
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
        400:
          description: Resource does not exist.
          content:
            application/json:
              schema:
                $ref: 'commons-models.openapi.yaml#/components/schemas/ApiError'
    delete:
      tags:
      - Bookings
      summary: Delete a reservation
      description: Delete a reservation
      operationId: deleteReservation
      parameters:
      - name: id
        in: path
        description: Booking's id
        required: true
        schema:
          type: integer
          format: int32
      responses:
        200:
          description: successful operation
          content: {}
        400:
          description: Resource does not exist.
          content:
            application/json:
              schema:
                $ref: 'commons-models.openapi.yaml#/components/schemas/ApiError'

  /v1/resources/bookings/export:
    get:
      tags: 
        - Bookings
      summary: Export des attributions
      description: Export des attributions
      operationId: bookingsExport
      parameters:
      - name: version
        in: query
        description: Version de la fiche S-13 (1 ou 2)
        required: true
        schema:
          type: integer
          format: int32
      - name: groupId
        in: query
        description: Group id
        required: true
        schema:
          type: integer
          format: int32
      - name: cityId
        in: query
        description: city id
        schema:
          type: integer
          format: int32
      - name: year
        in: query
        description: Year
        schema:
          type: integer
          format: int32
          example: 2024
      responses:
        200:
          $ref: 'commons-models.openapi.yaml#/components/responses/OkStream'
        '400':
          $ref: 'commons-models.openapi.yaml#/components/responses/BadRequest'
        '500':
          $ref: 'commons-models.openapi.yaml#/components/responses/InternalServerError'

  /v1/resources/bookings/statisticsExport:
    get:
      tags: 
        - Bookings
      summary: Export des statisques d'attributions
      description: Export des statisques d'attributions
      operationId: bookingsStatisticsExport
      parameters:
        - name: groupId
          in: query
          description: Group's id
          required: true
          schema:
            type: integer
            format: int32
        - name: cityId
          in: query
          description: City's id
          required: false
          schema:
            type: integer
            format: int32
        - name: territoryId
          in: query
          description: Territory's id
          required: false
          schema:
            type: integer
            format: int32
        - name: sort
          in: query
          description: Tri
          required: true
          schema:
            type: string
        - name: direction
          in: query
          description: Sens du tri (asc ou desc)
          required: true
          schema:
            type: string
            enum: [asc,desc]
        - name: startDate
          in: query
          description: Start date
          required: true
          schema:
            type: string
            format: Date
        - name: endDate
          in: query
          description: End date
          required: true
          schema:
            type: string
            format: Date
        - name: groupByFrequency
          description: Regroupe par fr√©quence
          in: query
          required: true
          schema:
            type: boolean
        - name: chart
          description: Affichage des graphiques par ville sous forme de camembert
          in: query
          required: true
          schema:
            type: boolean
        - name: format
          description: Format de sortie
          in: query
          required: true
          schema:
            type: string
            enum: [pdf,jpg,jpeg,png]
      responses:
        200:
          $ref: 'commons-models.openapi.yaml#/components/responses/OkStream'
        '400':
          $ref: 'commons-models.openapi.yaml#/components/responses/BadRequest'
        '500':
          $ref: 'commons-models.openapi.yaml#/components/responses/InternalServerError'

components:
  schemas:
    BookingIn:
      type: object
      required:
        - territory
        - contact
        - startDate
      properties:
        id:
          type: integer
          format: int32
        territory:
          type: integer
          format: int32
        event:
          type: integer
          format: int32
        contact:
          type: integer
          format: int32
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
    Booking:
      type: object
      properties:
        id:
          type: integer
          format: int32
        territory:
          $ref: 'api-territory-territory.openapi.yaml#/components/schemas/Territory'
        event:
          $ref: '#/components/schemas/Event'
        contact:
          $ref: 'commons-models.openapi.yaml#/components/schemas/Contact'
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        nbEmailsBookingSended:
          type: integer
          format: int32
        nbEmailsLateSended:
          type: integer
          format: int32
        nbMessagesWhatsappBookingSended:
          type: integer
          format: int32
        nbMessagesWhatsappBookingLateSended:
          type: integer
          format: int32
        nbMessagesSignalBookingSended:
          type: integer
          format: int32
        nbMessagesSignalBookingLateSended:
          type: integer
          format: int32
    Event:
      type: object
      properties:
        id:
          type: integer
          format: int32
        group:
          $ref: 'api-territory-group.openapi.yaml#/components/schemas/Group'
        name:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        status:
          maximum: 1E+1
          minimum: 1
          type: integer
          format: int32
          